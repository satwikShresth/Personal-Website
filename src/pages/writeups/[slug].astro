---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';
import { Badge } from '$lib/components/ui/badge';
import { Separator } from '$lib/components/ui/separator';
import * as Breadcrumb from '$lib/components/ui/breadcrumb';
import Calendar from '@lucide/svelte/icons/calendar';

export async function getStaticPaths() {
  const allWriteups = await getCollection('writeups');
  return allWriteups.map((writeup) => ({
    params: { slug: writeup.slug },
    props: { writeup },
  }));
}

const { writeup } = Astro.props;
const { Content } = await render(writeup);

const title = writeup.data.title;
const titleWords = title.trim().split(/\s+/);
const lastWord = titleWords.length > 1 ? titleWords.pop() : '';
const normalText = titleWords.join(' ');

export const prerender = true;
---

<Layout title={`${writeup.data.title} | Satwik Shresth`}>
  <div class="min-h-screen bg-background">
    <main class="w-full pt-20 lg:pt-24">
      <div class="max-w-4xl mx-auto px-6 lg:px-8 pb-16">
        <Breadcrumb.Root class="mb-6">
          <Breadcrumb.List class="text-base">
            <Breadcrumb.Item>
              <Breadcrumb.Link href="/">Home</Breadcrumb.Link>
            </Breadcrumb.Item>
            <Breadcrumb.Separator />
            <Breadcrumb.Item>
              <Breadcrumb.Link href="/writeups/">Writeups</Breadcrumb.Link>
            </Breadcrumb.Item>
            <Breadcrumb.Separator />
            <Breadcrumb.Item>
              <Breadcrumb.Page>{writeup.data.title}</Breadcrumb.Page>
            </Breadcrumb.Item>
          </Breadcrumb.List>
        </Breadcrumb.Root>
        
        <article>
          <header class="mb-8">
            <h1 class="text-4xl lg:text-6xl font-extrabold mb-6 text-foreground" style="font-family: 'Playfair Display', serif;">
              {normalText}{lastWord && <> <span class="text-primary">{lastWord}</span></>}
            </h1>
            
            <p class="text-xl lg:text-2xl text-muted-foreground/90 leading-relaxed mb-8">
              {writeup.data.description}
            </p>
            
            <div class="flex flex-col gap-4 mb-8">
              <div class="flex flex-wrap gap-2">
                {writeup.data.tags.map((tag) => (
                  <Badge variant="default">{tag}</Badge>
                ))}
              </div>
              
              <div class="flex items-center gap-6 text-sm text-muted-foreground">
                <div class="flex items-center gap-2">
                  <Calendar class="size-4" />
                  <span>{writeup.data.date}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span>Satwik Shresth</span>
                </div>
              </div>
            </div>
            
            <Separator class="w-3/4" />
          </header>
          
          <div class="writeup-content space-y-6 text-foreground leading-relaxed text-base md:text-lg">
            <Content />
          </div>
          
          <style>
            .writeup-content :global(h1),
            .writeup-content :global(h2),
            .writeup-content :global(h3),
            .writeup-content :global(h4) {
              font-family: 'Playfair Display', serif;
              font-weight: 600;
              margin-top: 2rem;
              margin-bottom: 1rem;
              line-height: 1.3;
            }
            
            .writeup-content :global(h2) {
              font-size: 1.875rem;
              margin-top: 2.5rem;
            }
            
            .writeup-content :global(h3) {
              font-size: 1.5rem;
            }
            
            .writeup-content :global(p) {
              margin-bottom: 1.25rem;
              line-height: 1.75;
            }
            
            .writeup-content :global(ul),
            .writeup-content :global(ol) {
              margin-bottom: 1.25rem;
              padding-left: 1.5rem;
              line-height: 1.75;
            }
            
            .writeup-content :global(li) {
              margin-bottom: 0.5rem;
            }
            
            .writeup-content :global(li > p) {
              margin-bottom: 0.5rem;
            }
            
            .writeup-content :global(strong) {
              font-weight: 600;
            }
            
            .writeup-content :global(code) {
              background-color: var(--muted);
              padding: 0.125rem 0.375rem;
              border-radius: 0.25rem;
              font-size: 0.875em;
              font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            }
            
            .writeup-content :global(pre) {
              background-color: var(--muted);
              padding: 1rem;
              border-radius: 0.5rem;
              overflow-x: auto;
              margin-bottom: 1.25rem;
            }
            
            .writeup-content :global(pre code) {
              background-color: transparent;
              padding: 0;
            }
            
            .writeup-content :global(a) {
              color: var(--primary);
              text-decoration: underline;
            }
            
            .writeup-content :global(a:hover) {
              opacity: 0.8;
            }
            
            .writeup-content :global(img) {
              margin: 2rem 0;
              border-radius: 0.5rem;
            }
            
            .writeup-content :global(blockquote) {
              border-left: 4px solid var(--border);
              padding-left: 1rem;
              margin: 1.5rem 0;
              font-style: italic;
              color: var(--muted-foreground);
            }
          </style>
        </article>
      </div>
    </main>
  </div>
</Layout>
